<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GMarket - Market</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="/styles/main.css">
    <script type="text/javascript" src="https://s3.tradingview.com/tv.js"></script>
    <script type="text/javascript" src="https://s3.tradingview.com/external-embedding/embed-widget-symbol-overview.js"></script>
</head>
<body>
    <header>
        <div class="logo-container">
            <img src="../images/gmarket-logo.png" alt="GMarket Logo" class="logo">
        </div>
        <nav>
            <ul>
                <li><a href="/pages/home.html">Home</a></li>
                <li><a href="/pages/contact.html">Contact Us</a></li>
                <li class="auth-not-required"><a href="/pages/signin.html">Sign In</a></li>
                <li class="auth-not-required"><a href="/pages/signup.html">Sign Up</a></li>
            </ul>
        </nav>
    </header>
    <main>
        <h1>Markets</h1>

        <section id="indices" class="market-section">
            <h2>Indices</h2>
            <div class="chart-container">
                <div class="chart" id="index-sp500"></div>
                <div class="chart" id="index-nasdaq"></div>
                <div class="chart" id="index-djia"></div>
            </div>
        </section>

        <section id="stocks" class="market-section">
            <h2>Stocks</h2>
            <div class="chart-container">
                <div class="chart-wrapper">
                    <h3 class="chart-title">AAPL - Apple Inc.</h3>
                    <div class="chart" id="stock-aapl"></div>
                </div>
                <div class="chart-wrapper">
                    <h3 class="chart-title">GOOGL - Alphabet Inc.</h3>
                    <div class="chart" id="stock-googl"></div>
                </div>
                <div class="chart-wrapper">
                    <h3 class="chart-title">MSFT - Microsoft Corp.</h3>
                    <div class="chart" id="stock-msft"></div>
                </div>
            </div>
        </section>

        <section id="etfs" class="market-section">
            <h2>ETFs</h2>
            <div class="chart-container">
                <div class="chart" id="etf-spy"></div>
                <div class="chart" id="etf-qqq"></div>
                <div class="chart" id="etf-voo"></div>
            </div>
        </section>

        <section id="crypto" class="market-section">
            <h2>Cryptocurrencies</h2>
            <div class="chart-container">
                <div class="chart-wrapper">
                    <h3 class="chart-title">BTC/USD - Bitcoin</h3>
                    <div class="chart" id="crypto-btcusd"></div>
                </div>
                <div class="chart-wrapper">
                    <h3 class="chart-title">ETH/USD - Ethereum</h3>
                    <div class="chart" id="crypto-ethusd"></div>
                </div>
                <div class="chart-wrapper">
                    <h3 class="chart-title">XRP/USD - Ripple</h3>
                    <div class="chart" id="crypto-xrpusd"></div>
                </div>
            </div>
        </section>

        <section id="forex" class="market-section">
            <h2>Forex</h2>
            <div class="chart-container">
                <div class="chart" id="forex-eurusd"></div>
                <div class="chart" id="forex-gbpusd"></div>
                <div class="chart" id="forex-usdjpy"></div>
            </div>
        </section>

        <section id="futures" class="market-section">
            <h2>Futures</h2>
            <div class="chart-container">
                <div class="chart" id="futures-cl1"></div>
                <div class="chart" id="futures-gc1"></div>
                <div class="chart" id="futures-zc1"></div>
            </div>
        </section>

        <section id="bonds" class="market-section">
            <h2>Bonds</h2>
            <div class="chart-container">
                <div class="chart" id="bond-us10y"></div>
                <div class="chart" id="bond-de10y"></div>
                <div class="chart" id="bond-gb10y"></div>
            </div>
        </section>
        <div id="loading-indicator" class="loading-container">
            <div class="loading-spinner"></div>
        </div>
    </main>
    <footer>
        <p>&copy; <span id="current-year"></span> GMarket. All rights reserved.</p>
    </footer>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script>
        const firebaseConfig = {
            // Your Firebase config here
        };
        firebase.initializeApp(firebaseConfig);
    </script>
    <script type="module" src="/scripts/main.js"></script>
    <script>
        document.getElementById('current-year').textContent = new Date().getFullYear();
    </script>
    <script>
        function createChart(container, symbol, type = 'line') {
            return new Promise((resolve, reject) => {
                try {
                    const chartContainer = document.getElementById(container);
                    const widget = new TradingView.widget({
                        "width": "100%",
                        "height": "400",
                        "symbol": symbol,
                        "interval": "D",
                        "timezone": "exchange",
                        "theme": "dark",
                        "style": "1",
                        "locale": "en",
                        "enable_publishing": false,
                        "allow_symbol_change": true,
                        "container_id": container,
                        "hide_top_toolbar": false,
                        "hide_legend": false,
                        "save_image": false,
                        "studies": [
                            "MASimple@tv-basicstudies"
                        ],
                        "show_popup_button": false,
                        "popup_width": "1000",
                        "popup_height": "650",
                        "autosize": true
                    });

                    widget.onChartReady(() => {
                        resolve();
                    });

                } catch (error) {
                    console.error(`Error creating chart for ${symbol}:`, error);
                    reject(error);
                }
            });
        }

        function hideLoading() {
            document.getElementById('loading-indicator').style.display = 'none';
        }

        const charts = [
            { id: "index-sp500", symbol: "SPX", title: "S&P 500" },
            { id: "index-nasdaq", symbol: "NASDAQ:NDX", title: "NASDAQ 100" },
            { id: "index-djia", symbol: "DJIA", title: "Dow Jones Industrial Average" },
            { id: "stock-aapl", symbol: "AAPL", title: "AAPL - Apple Inc." },
            { id: "stock-googl", symbol: "GOOGL", title: "GOOGL - Alphabet Inc." },
            { id: "stock-msft", symbol: "MSFT", title: "MSFT - Microsoft Corp." },
            { id: "etf-spy", symbol: "SPY", title: "SPY - SPDR S&P 500 ETF" },
            { id: "etf-qqq", symbol: "QQQ", title: "QQQ - Invesco QQQ Trust" },
            { id: "etf-voo", symbol: "VOO", title: "VOO - Vanguard S&P 500 ETF" },
            { id: "crypto-btcusd", symbol: "BINANCE:BTCUSDT", title: "BTC/USD - Bitcoin" },
            { id: "crypto-ethusd", symbol: "BINANCE:ETHUSDT", title: "ETH/USD - Ethereum" },
            { id: "crypto-xrpusd", symbol: "BINANCE:XRPUSDT", title: "XRP/USD - Ripple" },
            { id: "forex-eurusd", symbol: "OANDA:EURUSD", title: "EUR/USD" },
            { id: "forex-gbpusd", symbol: "OANDA:GBPUSD", title: "GBP/USD" },
            { id: "forex-usdjpy", symbol: "OANDA:USDJPY", title: "USD/JPY" },
            { id: "futures-cl1", symbol: "NYMEX:CL1!", title: "Crude Oil Futures" },
            { id: "futures-gc1", symbol: "COMEX:GC1!", title: "Gold Futures" },
            { id: "futures-zc1", symbol: "CBOT:ZC1!", title: "Corn Futures" }
        ];

        function initCharts() {
            charts.forEach(chart => {
                const wrapper = document.getElementById(chart.id).parentElement;
                const titleEl = wrapper.querySelector('.chart-title');
                if (titleEl) {
                    titleEl.textContent = chart.title;
                }
                createChart(chart.id, chart.symbol)
                    .then(() => {
                        // ... existing code ...
                    })
                    .catch(() => {
                        // ... existing code ...
                    });
            });
        }

        document.addEventListener('DOMContentLoaded', initCharts);
    </script>
    <script>
        function showErrorMessage(message) {
            const errorDiv = document.createElement('div');
            errorDiv.textContent = message;
            errorDiv.style.color = 'red';
            errorDiv.style.textAlign = 'center';
            errorDiv.style.marginTop = '20px';
            document.querySelector('main').appendChild(errorDiv);
        }
    </script>
    <div id="logout-container" class="auth-required" style="position: fixed; bottom: 20px; right: 20px; display: none;">
        <button id="logoutBtn">Logout</button>
    </div>
</body>
</html>
